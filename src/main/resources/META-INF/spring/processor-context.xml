<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd 
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd 
	http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd" >

	<bean id="feedProcessorFactoryId" class="io.delimeat.processor.FeedProcessorFactory_Impl">
		<property name="folderTorrentValidator" ref="torrentFolderValidatorId"/>
		<property name="preferFilesComparator" ref="preferFilesComparatorId"/>
		<property name="maxSeedersComparator" ref="maxSeedersComparatorId"/>
		<property name="processorTypes">
			<map>
				<entry key="SEASON">
					<value>seasonFeedProcessorId</value>
				</entry>
				<entry key="ANIMATED">
					<value>seasonFeedProcessorId</value>
				</entry>
				<entry key="DAILY">
					<value>dailyFeedProcessorId</value>
				</entry>
				<entry key="MINI_SERIES">
					<value>seasonFeedProcessorId</value>
				</entry>
			</map>
		</property>
	</bean>   
	
	<!-- Feed Result Validators -->
	<bean id="feedResultDailyValidatorId" class="io.delimeat.processor.validation.FeedResultDailyValidator_Impl"/>

	<bean id="feedResultMiniSeriesValidatorId" class="io.delimeat.processor.validation.FeedResultMiniSeriesValidator_Impl"/>
	
	<bean id="feedResultSeasonValidatorId" class="io.delimeat.processor.validation.FeedResultSeasonValidator_Impl"/>
	  
	<bean id="feedResultTitleValidatorId" class="io.delimeat.processor.validation.FeedResultTitleValidator_Impl"/>

	<bean id="feedResultExcludedKeywordValidatorId" class="io.delimeat.processor.validation.FeedResultExcludedKeywordValidator_Impl"/>

	<!-- Torrent Validators -->
	<bean id="torrentCompressedValidatorId" class="io.delimeat.processor.validation.TorrentCompressedValidator_Impl"/>

	<bean id="torrentFileTypeValidatorId" class="io.delimeat.processor.validation.TorrentFileTypeValidator_Impl"/>

	<bean id="torrentFolderValidatorId" class="io.delimeat.processor.validation.TorrentFolderValidator_Impl"/>

	<bean id="torrentSeederValidatorId" class="io.delimeat.processor.validation.TorrentSeederValidator_Impl">
		<property name="torrentService" ref="torrentServiceId"/>
	</bean>

	<bean id="torrentSizeValidatorId" class="io.delimeat.processor.validation.TorrentSizeValidator_Impl"/>
 
 	<!-- Feed Result Comparator -->
	<bean id="maxSeedersComparatorId" class="io.delimeat.feed.comparator.MaxSeederFeedResultComparator_Impl"/>

	<bean id="preferFilesComparatorId" class="io.delimeat.feed.comparator.MaxSeederPreferFileFeedResultComparator_Impl"/>
  
    <bean id="abstractFeedProcessorId" class="io.delimeat.processor.FeedProcessor_Impl" abstract="true">
    	<property name="torrentService" ref="torrentServiceId"/>
    	<property name="feedService" ref="feedServiceId"/>   	
    	<property name="episodeService" ref="episodeServiceId"/>
       
		<property name="torrentValidators">
			<list>
				<ref bean="torrentCompressedValidatorId"/>
				<ref bean="torrentFileTypeValidatorId"/>
				<ref bean="torrentSeederValidatorId"/>
				<ref bean="torrentSizeValidatorId"/>
			</list>
		</property>
		
		<property name="feedResultValidators">
    	    <list>
				<ref bean="feedResultTitleValidatorId"/>
            	<ref bean="feedResultExcludedKeywordValidatorId"/>
            </list>
        </property>
    </bean>
   
    <bean id="seasonFeedProcessorId" parent="abstractFeedProcessorId" scope="prototype">
		<property name="feedResultValidators">
    	    <list merge="true">
				<ref bean="feedResultSeasonValidatorId"/>
            </list>
        </property>
    </bean>
    
    <bean id="dailyFeedProcessorId" parent="abstractFeedProcessorId" scope="prototype">
		<property name="feedResultValidators">
    	    <list merge="true">
				<ref bean="feedResultDailyValidatorId"/>
            </list>
        </property>
    </bean>
    
    <bean id="guideProcessorId" class="io.delimeat.processor.GuideProcessor_Impl" scope="prototype">
		<property name="showService" ref="showServiceId"/>	
		<property name="guideService" ref="guideServiceId"/>	
    </bean>
  
 	<bean id="guideProcessorFactoryId" class="io.delimeat.processor.GuideProcessorFactory_Impl"/>	
 	
	<bean id="processorExecutorId" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
	    <!--
	    <property name="corePoolSize" value="1" />
	    <property name="maxPoolSize" value="10" />
	    <property name="queueCapacity" value="25" />
	    !-->	
	</bean>
	
	<bean id="processorServiceId" class="io.delimeat.processor.ProcessorService_Impl">
        <property name="showService" ref="showServiceId"/>
        <property name="configService" ref="configServiceId"/>
        <property name="episodeService" ref="episodeServiceId"/>
        <property name="guideProcessorFactory" ref="guideProcessorFactoryId"/>
        <property name="feedProcessorFactory" ref="feedProcessorFactoryId"/>
        <property name="executor" ref="processorExecutorId"/>
    </bean>
    
	<task:scheduler id="processorSchedulerId" pool-size="1" />

	<task:scheduled-tasks scheduler="processorSchedulerId">
		<task:scheduled ref="processorServiceId" method="processAllGuideUpdates"
			fixed-delay="${io.delimeat.processor.guide.schedule}" initial-delay="${io.delimeat.processor.guide.schedule.initial}" />
	</task:scheduled-tasks>
	
	<task:scheduled-tasks scheduler="processorSchedulerId">
		<task:scheduled ref="processorServiceId" method="processAllFeedUpdates"
			fixed-delay="${io.delimeat.processor.feed.schedule}" initial-delay="${io.delimeat.processor.feed.schedule.initial}" />
	</task:scheduled-tasks>				
  
</beans>